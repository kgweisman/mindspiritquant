---
title: "Study 4"
subtitle: "Luhrmann, Weisman, et al."
output: 
  html_notebook:
    theme: flatly
    toc: true
    toc_float: true
---

In this notebook, we analyze Study 4: Confirmatory work with undergraduates.

```{r}
source("../../scripts_general/dependencies.R")
source("../../scripts_general/custom_funs.R")
source("../../scripts_general/var_recode_contrast.R")
```

```{r}
theme_set(theme_bw())
```

```{r}
d4_byquestion_raw <- read_csv("../data/study4_byquestion.csv") %>%
  select(-X1) %>%
  mutate(p7_ctry = factor(p7_ctry, levels = levels_country))

source("../scripts_s4/s4_var_groups.R")
```

```{r}
d4_byquestion <- full_join(d4_byquestion_raw %>%
                             select(p7_ctry, p7_subj, s4_var_pv) %>%
                             gather(question, response, s4_var_pv) %>%
                             mutate(scale = "pv_score"),
                           d4_byquestion_raw %>%
                             select(p7_ctry, p7_subj, s4_var_por) %>%
                             gather(question, response, s4_var_por) %>%
                             mutate(scale = "por_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_abs) %>%
              gather(question, response, s4_var_abs) %>%
              mutate(scale = "abs_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_dse) %>%
              gather(question, response, s4_var_dse) %>%
              mutate(scale = "dse_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_spev) %>%
              gather(question, response, s4_var_spev) %>%
              mutate(scale = "spev_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_hall) %>%
              gather(question, response, s4_var_hall) %>%
              mutate(scale = "hall_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_para) %>%
              gather(question, response, s4_var_para) %>%
              mutate(scale = "para_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_cog) %>%
              gather(question, response, s4_var_cog) %>%
              mutate(scale = "cog_score")) %>%
  full_join(d4_byquestion_raw %>%
              select(p7_ctry, p7_subj, s4_var_ctl) %>%
              gather(question, response, s4_var_ctl) %>%
              mutate(scale = "ctl_score")) %>%
  mutate(p7_ctry = factor(p7_ctry, levels = levels_country))
```

```{r}
d4_0 <- d4_byquestion %>%
  group_by(p7_subj, scale) %>%
  mutate(score = mean(response, na.rm = T)) %>%
  ungroup() %>%
  mutate(study = "study 4") %>%
  distinct(study, p7_ctry, p7_subj, scale, score) %>%
  spread(scale, score)

d4_std <- d4_0 %>%
  group_by(study) %>%
  mutate_at(vars(ends_with("_score")), funs(std = scale)) %>%
  ungroup()

d4_std2 <- d4_0 %>%
  group_by(study, p7_ctry) %>%
  mutate_at(vars(ends_with("_score")), funs(std2 = scale)) %>%
  ungroup()

d4 <- d4_0 %>% full_join(d4_std) %>% full_join(d4_std2) %>%
  mutate(p7_ctry = factor(p7_ctry, levels = levels_country))
```

```{r}
contrasts(d4_byquestion$p7_ctry) <- contrasts_country
contrasts(d4$p7_ctry) <- contrasts_country
```


# Demographics

```{r}
# all participants included in dataset
d4 %>% distinct(p7_subj) %>% count()
```

```{r}
# participants missing porosity scale score
d4 %>% 
  filter(is.na(por_score)) %>% 
  distinct(as.character(p7_subj)) %>%
  count()

# participants missing porosity vignettes score
d4 %>% 
  filter(is.na(pv_score)) %>% 
  distinct(as.character(p7_subj)) %>%
  count()

# participants missing absorption score
d4 %>% 
  filter(is.na(abs_score)) %>% 
  distinct(as.character(p7_subj)) %>%
  count()

# participants missing daily spiritual experiences score
d4 %>% 
  filter(is.na(dse_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()

# participants missing spiritual events score
d4 %>% 
  filter(is.na(spev_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()

# participants missing hallucinations score
d4 %>% 
  filter(is.na(hall_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()

# participants missing paranormal score
d4 %>% 
  filter(is.na(para_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()

# participants missing sense of control score
d4 %>% 
  filter(is.na(ctl_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()

# participants missing need for cognition score
d4 %>% 
  filter(is.na(cog_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()


# participants with complete data for primary analysis
d4 %>% 
  filter(!is.na(por_score),
         !is.na(pv_score),
         !is.na(abs_score),
         !is.na(dse_score),
         !is.na(spev_score),
         !is.na(hall_score),
         !is.na(para_score),
         !is.na(ctl_score),
         !is.na(cog_score)) %>% 
  distinct(as.character(p7_subj)) %>% 
  count()
```

```{r}
s4_sub <- d4 %>% 
  filter(!is.na(por_score),
         !is.na(pv_score),
         !is.na(abs_score),
         !is.na(dse_score),
         !is.na(spev_score),
         !is.na(hall_score),
         !is.na(para_score),
         !is.na(ctl_score),
         !is.na(cog_score)) %>% 
  mutate(p7_subj = as.character(p7_subj)) %>%
  distinct(p7_subj)

d4x <- d4 %>% filter(p7_subj %in% s4_sub$p7_subj)
d4x_byquestion <- d4_byquestion %>% filter(p7_subj %in% s4_sub$p7_subj)
```

XX FILL IN MORE DEMOGRAPHICS


# Predicting Spiritual Experiences

```{r}
d4_long <- d4 %>%
  select(p7_ctry, p7_subj, 
         por_score_std, pv_score_std, abs_score_std, dse_score_std, spev_score_std) %>%
  gather(spirit_scale, spirit_score_std, 
         c(dse_score_std, spev_score_std)) %>%
  mutate(spirit_scale = factor(spirit_scale, 
                               levels = c("dse_score_std", "spev_score_std")))

contrasts(d4_long$p7_ctry) <- contrasts_country; contrasts(d4_long$p7_ctry)
contrasts(d4_long$spirit_scale) <- cbind("_spev" = c(-1, 1)); contrasts(d4_long$spirit_scale)
```

## Attempting to fit more complex random effects structures

```{r}
r1a <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
              (1 + por_score_std * abs_score_std | p7_ctry), d4_long) # singular
r1b <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
              (1 + por_score_std * abs_score_std || p7_ctry), d4_long) # singular
r1c <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
              (1 + por_score_std + abs_score_std || p7_ctry), d4_long) # singular
r1d <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
              (1 | p7_ctry), d4_long) # fine, but doesn't include scale or repeated measures
r1e <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
              (1 | p7_ctry/p7_subj), d4_long) # fine, but doesn't include scale
r1f <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
              (1 | p7_ctry/p7_subj) + (1 | spirit_scale), d4_long) # singular

r1f1 <- lmer(spirit_score_std ~ por_score_std * abs_score_std + 
               (1 | p7_ctry/p7_subj) + (1 | spirit_scale), d4_long) # singular
```

```{r}
temp <- lmer(spirit_score_std ~ por_score_std * abs_score_std +
               (1 | p7_ctry/p7_subj) + 
               # (0 + por_score_std * abs_score_std | spirit_scale), # singular
               # (0 + por_score_std * abs_score_std || spirit_scale), # singular
               (0 + por_score_std + abs_score_std || spirit_scale), #only 1df for abs
             # (0 + por_score_std | spirit_scale), #only <2df for por
             # (0 + abs_score_std | spirit_scale), # fails to converge
             d4_long)
summary(temp)
```

```{r}
r1g_por <- lmer(spirit_score_std ~ por_score_std * abs_score_std * spirit_scale +
                  (1 | p7_ctry/p7_subj), d4_long) # fine
regtab_fun(r1g_por, por_name = "Porosity Scale") %>% regtab_style_fun(row_emph = 2:3)
regtab_ran_fun(r1g_por, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
r1g_pv <- lmer(spirit_score_std ~ por_score_std * abs_score_std * spirit_scale +
                 (1 | p7_ctry/p7_subj), d4_long) # fine
regtab_fun(r1g_pv, por_name = "Porosity Vignettes") %>% regtab_style_fun(row_emph = 2:3)
regtab_ran_fun(r1g_pv, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
r1h_dse <- lmer(dse_score_std ~ por_score_std * abs_score_std + (1 | p7_ctry), d4)
regtab_fun(r1h_dse, por_name = "Porosity Scale") %>% regtab_style_fun(row_emph = 2:3)
```

```{r}
r1h_spev <- lmer(spev_score_std ~ por_score_std * abs_score_std + (1 | p7_ctry), d4)
regtab_fun(r1h_spev, por_name = "Porosity Scale") %>% regtab_style_fun(row_emph = 2:3)
```


```{r}
r1i_dse <- lmer(dse_score_std ~ pv_score_std * abs_score_std + (1 | p7_ctry), d4)
regtab_fun(r1i_dse, 
           por_var = "pv_score_std",
           por_name = "Porosity Vignettes") %>% 
  regtab_style_fun(row_emph = 2:3)
```

```{r}
r1i_spev <- lmer(spev_score_std ~ pv_score_std * abs_score_std + (1 | p7_ctry), d4)
regtab_fun(r1i_spev,
           por_var = "pv_score_std",
           por_name = "Porosity Vignettes") %>% 
  regtab_style_fun(row_emph = 2:3)
```

```{r}
# XX BOOKMARK: not good because doubles size of dataset!
# r1j_spev <- lmer(spev_score_std ~ POR * abs_score_std +
#                    (1 | p7_ctry) + (1 | por_scale),
#                  d4 %>%
#                    distinct(p7_ctry, p7_subj, spev_score_std, abs_score_std,
#                             por_score_std, pv_score_std) %>%
#                    gather(por_scale, POR, c(por_score_std, pv_score_std)) %>%
#                    mutate(por_scale = factor(por_scale)),
#                  contrasts = list(por_scale = "contr.sum"))
# regtab_fun(r1j_spev,
#            por_var = "POR",
#            por_name = "POROSITY (overall)") %>%
#   regtab_style_fun(row_emph = 2:3)
```



## Primary analyses

### Porosity Scale

```{r}
r1_por <- lmer(spirit_score_std ~ por_score_std * spirit_scale +
                 (1 | p7_ctry/p7_subj), d4_long) 
regtab_fun(r1_por, por_name = "Porosity Scale") %>% regtab_style_fun(row_emph = 2)
regtab_ran_fun(r1_por, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
rsquared(r1_por)
```

### Porosity Vignettes

```{r}
r1_pv <- lmer(spirit_score_std ~ pv_score_std * spirit_scale +
                (1 | p7_ctry/p7_subj), d4_long) 
regtab_fun(r1_pv, por_name = "Porosity Vignettes") %>% regtab_style_fun(row_emph = 2)
regtab_ran_fun(r1_pv, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
rsquared(r1_pv)
```

### Absorption

```{r}
r1_abs <- lmer(spirit_score_std ~ abs_score_std * spirit_scale +
                 (1 | p7_ctry/p7_subj), d4_long) 
regtab_fun(r1_abs) %>% regtab_style_fun(row_emph = 2)
regtab_ran_fun(r1_abs, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
rsquared(r1_abs)
```

## Bayesian regression

### Porosity Scale

```{r}
# r1_bayes_por <- brm(spirit_score_std ~ por_score_std * spirit_scale +
#                       (1 | p7_ctry/p7_subj), d4_long,
#                     control = list(adapt_delta = 0.99),
#                     seed = 1234, cores = 4, chains = 4) 
# saveRDS(r1_bayes_por, "./models/r1_bayes_por.RDS")

r1_bayes_por <- readRDS("./models/r1_bayes_por.RDS")
```

```{r}
regtab_fun(r1_bayes_por, por_name = "Porosity Scale") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r1_bayes_por, country_var = "p7_ctry", subj_var = "p7_subj") %>% 
  regtab_style_fun()
```

```{r}
bayes_R2(r1_bayes_por)
```

### Porosity Vignettes

```{r}
# r1_bayes_pv <- brm(spirit_score_std ~ pv_score_std * spirit_scale +
#                       (1 | p7_ctry/p7_subj), d4_long,
#                     control = list(adapt_delta = 0.99),
#                     seed = 1234, cores = 4, chains = 4)
# saveRDS(r1_bayes_pv, "./models/r1_bayes_pv.RDS")

r1_bayes_pv <- readRDS("./models/r1_bayes_pv.RDS")
```

```{r}
regtab_fun(r1_bayes_pv, por_var = "pv_score_std", por_name = "Porosity Vignettes") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r1_bayes_pv, country_var = "p7_ctry", subj_var = "p7_subj") %>% 
  regtab_style_fun()
```

```{r}
bayes_R2(r1_bayes_pv)
```

### Absorption

```{r}
# r1_bayes_abs <- brm(spirit_score_std ~ abs_score_std * spirit_scale +
#                       (1 | p7_ctry/p7_subj), d4_long,
#                     control = list(adapt_delta = 0.99),
#                     seed = 1234, cores = 4, chains = 4)
# saveRDS(r1_bayes_abs, "./models/r1_bayes_abs.RDS")

r1_bayes_abs <- readRDS("./models/r1_bayes_abs.RDS")
```

```{r}
regtab_fun(r1_bayes_abs) %>% regtab_style_fun(row_emph = 2)
regtab_ran_fun(r1_bayes_abs, country_var = "p7_ctry", subj_var = "p7_subj") %>% 
  regtab_style_fun()
```

```{r}
bayes_R2(r1_bayes_abs)
```


## Country as fixed effect

### Porosity Scale

```{r}
r2_por <- lmer(spirit_score_std ~ por_score_std * spirit_scale * p7_ctry +
                 (1 | p7_subj), d4_long) 
regtab_fun(r2_por, 
           por_name = "Porosity Scale",
           country_var1 = "p7_ctry_gh",
           country_var2 = "p7_ctry_th",
           country_var3 = "p7_ctry_ch",
           country_var4 = "p7_ctry_vt") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r2_por, subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
rsquared(r2_por)
```

### Porosity Vignettes

```{r}
r2_pv <- lmer(spirit_score_std ~ pv_score_std * spirit_scale * p7_ctry +
                (1 | p7_subj), d4_long) 
regtab_fun(r2_pv, 
           por_var = "pv_score_std",
           por_name = "Porosity Vignettes",
           country_var1 = "p7_ctry_gh",
           country_var2 = "p7_ctry_th",
           country_var3 = "p7_ctry_ch",
           country_var4 = "p7_ctry_vt",
           scale_var = "spirit_scale_spev") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r2_pv, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
rsquared(r2_pv)
```

### Absorption

```{r}
r2_abs <- lmer(spirit_score_std ~ abs_score_std * spirit_scale * p7_ctry +
                 (1 | p7_subj), d4_long) 
regtab_fun(r2_abs, 
           country_var1 = "p7_ctry_gh", 
           country_var2 = "p7_ctry_th",
           country_var3 = "p7_ctry_ch",
           country_var4 = "p7_ctry_vt",
           scale_var = "spirit_scale_spev",
           scale_name = "Scale (Sp. Ev.)") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r2_abs, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

```{r}
rsquared(r2_abs)
```




## Within each site considered alone

```{r}
d4_long_bycountry <- d4 %>%
  select(p7_ctry, p7_subj, 
         por_score_std2, pv_score_std2, abs_score_std2, 
         dse_score_std2, spev_score_std2) %>%
  gather(spirit_scale, spirit_score_std2, 
         c(dse_score_std2, spev_score_std2)) %>%
  mutate(spirit_scale = factor(spirit_scale, 
                               levels = c("dse_score_std2", "spev_score_std2")))

contrasts(d4_long_bycountry$p7_ctry) <- contrasts_country; contrasts(d4_long$p7_ctry)
contrasts(d4_long_bycountry$spirit_scale) <- cbind("_spev" = c(-1, 1)); contrasts(d4_long_bycountry$spirit_scale)
```

### Porosity Scale

```{r}
r1_por_us <- lmer(spirit_score_std2 ~ por_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "US")) 
r1_por_gh <- lmer(spirit_score_std2 ~ por_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Ghana")) 
r1_por_th <- lmer(spirit_score_std2 ~ por_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Thailand")) 
r1_por_ch <- lmer(spirit_score_std2 ~ por_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "China")) 
r1_por_vt <- lmer(spirit_score_std2 ~ por_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Vanuatu")) 
```

```{r}
r1_por_bycountry <- bind_rows(
  r1_por_us %>% 
    regtab_fun(por_var = "por_score_std2", por_name = "Porosity Scale") %>% 
    mutate(Country = "US"),
  r1_por_gh %>% 
    regtab_fun(por_var = "por_score_std2", por_name = "Porosity Scale") %>% 
    mutate(Country = "Ghana"),
  r1_por_th %>% 
    regtab_fun(por_var = "por_score_std2", por_name = "Porosity Scale") %>% 
    mutate(Country = "Thailand"),
  r1_por_ch %>% 
    regtab_fun(por_var = "por_score_std2", por_name = "Porosity Scale") %>% 
    mutate(Country = "China"),
  r1_por_vt %>% 
    regtab_fun(por_var = "por_score_std2", por_name = "Porosity Scale") %>% 
    mutate(Country = "Vanuatu"))
```

```{r}
r1_por_bycountry %>%
  filter(Parameter == "Porosity Scale")
```

### Porosity Vignettes

```{r}
r1_pv_us <- lmer(spirit_score_std2 ~ pv_score_std2 * spirit_scale +
                   (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "US")) 
r1_pv_gh <- lmer(spirit_score_std2 ~ pv_score_std2 * spirit_scale +
                   (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Ghana")) 
r1_pv_th <- lmer(spirit_score_std2 ~ pv_score_std2 * spirit_scale +
                   (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Thailand")) 
r1_pv_ch <- lmer(spirit_score_std2 ~ pv_score_std2 * spirit_scale +
                   (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "China")) 
r1_pv_vt <- lmer(spirit_score_std2 ~ pv_score_std2 * spirit_scale +
                   (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Vanuatu")) 
```

```{r}
r1_pv_bycountry <- bind_rows(
  r1_pv_us %>% 
    regtab_fun(por_var = "pv_score_std2", por_name = "Porosity Vignettes") %>% 
    mutate(Country = "US"),
  r1_pv_gh %>% 
    regtab_fun(por_var = "pv_score_std2", por_name = "Porosity Vignettes") %>% 
    mutate(Country = "Ghana"),
  r1_pv_th %>% 
    regtab_fun(por_var = "pv_score_std2", por_name = "Porosity Vignettes") %>% 
    mutate(Country = "Thailand"),
  r1_pv_ch %>% 
    regtab_fun(por_var = "pv_score_std2", por_name = "Porosity Vignettes") %>% 
    mutate(Country = "China"),
  r1_pv_vt %>% 
    regtab_fun(por_var = "pv_score_std2", por_name = "Porosity Vignettes") %>% 
    mutate(Country = "Vanuatu"))
```

```{r}
r1_pv_bycountry %>%
  filter(Parameter == "Porosity Vignettes")
```

### Absorption

```{r}
r1_abs_us <- lmer(spirit_score_std2 ~ abs_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "US")) 
r1_abs_gh <- lmer(spirit_score_std2 ~ abs_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Ghana")) 
r1_abs_th <- lmer(spirit_score_std2 ~ abs_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Thailand")) 
r1_abs_ch <- lmer(spirit_score_std2 ~ abs_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "China")) 
r1_abs_vt <- lmer(spirit_score_std2 ~ abs_score_std2 * spirit_scale +
                    (1 | p7_subj), d4_long_bycountry %>% filter(p7_ctry == "Vanuatu")) 
```

```{r}
r1_abs_bycountry <- bind_rows(
  r1_abs_us %>% 
    regtab_fun(abs_var = "abs_score_std2") %>% 
    mutate(Country = "US"),
  r1_abs_gh %>% 
    regtab_fun(abs_var = "abs_score_std2") %>% 
    mutate(Country = "Ghana"),
  r1_abs_th %>% 
    regtab_fun(abs_var = "abs_score_std2") %>% 
    mutate(Country = "Thailand"),
  r1_abs_ch %>% 
    regtab_fun(abs_var = "abs_score_std2") %>% 
    mutate(Country = "China"),
  r1_abs_vt %>% 
    regtab_fun(abs_var = "abs_score_std2") %>% 
    mutate(Country = "Vanuatu"))
```

```{r}
r1_abs_bycountry %>%
  filter(Parameter == "Absorption")
```

```{r}
bind_rows(r1_por_bycountry %>% filter(Parameter == "Porosity Scale"),
          r1_pv_bycountry %>% filter(Parameter == "Porosity Vignettes"),
          r1_abs_bycountry %>% filter(Parameter == "Absorption")) %>%
  filter(` ` != "") %>%
  # filter(Country != "Vanuatu") %>%
  summarise(min_beta = min(β),
            max_p = max(p))
```

```{r}
bind_rows(r1_por_bycountry %>% filter(Parameter == "Porosity Scale"),
          r1_pv_bycountry %>% filter(Parameter == "Porosity Vignettes"),
          r1_abs_bycountry %>% filter(Parameter == "Absorption")) %>%
  filter(` ` == "")
```

```{r}
d4_long_bycountry %>% distinct(p7_ctry, p7_subj) %>% count(p7_ctry)
```


# Predicting other extraordinary experiences

## Primary analyses

```{r}
d4_long_other <- d4 %>%
  select(p7_ctry, p7_subj, 
         por_score_std, pv_score_std, abs_score_std, hall_score_std, para_score_std) %>%
  gather(other_scale, other_score_std, 
         c(hall_score_std, para_score_std)) %>%
  mutate(other_scale = factor(other_scale, 
                              levels = c("hall_score_std", "para_score_std")))

contrasts(d4_long_other$p7_ctry) <- contrasts_country; contrasts(d4_long$p7_ctry)
contrasts(d4_long_other$other_scale) <- cbind("_para" = c(-1, 1)); contrasts(d4_long_other$other_scale)
```

### Porosity Scale

```{r}
r2_por <- lmer(other_score_std ~ por_score_std * other_scale +
                 (1 | p7_ctry/p7_subj), d4_long_other) 
regtab_fun(r2_por, 
           por_name = "Porosity Scale", scale_var = "other_scale_para",
           scale_name = "Other Experience scale (Paranormal)") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r2_por, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

### Porosity Vignettes

```{r}
r2_pv <- lmer(other_score_std ~ pv_score_std * other_scale +
                (1 | p7_ctry/p7_subj), d4_long_other) 
regtab_fun(r2_pv, por_var = "pv_score_std", por_name = "Porosity Vignettes",
           scale_var = "other_scale_para",
           scale_name = "Other Experience scale (Paranormal") %>% 
  regtab_style_fun(row_emph = 2)
regtab_ran_fun(r2_pv, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```

### Absorption

```{r}
r2_abs <- lmer(other_score_std ~ abs_score_std * other_scale +
                 (1 | p7_ctry/p7_subj), d4_long_other) 
regtab_fun(r2_abs, scale_var = "other_scale_para", scale_name = "Other Experience scale (Para.)") %>% regtab_style_fun(row_emph = 2)
regtab_ran_fun(r2_abs, country_var = "p7_ctry", subj_var = "p7_subj") %>% regtab_style_fun()
```


# Comparing to control measures

XX BOOKMARK


# Porosity and absorption in a single model

XX BOOKMARK


# Cultural invitation vs. individual difference

XX BOOKMARK
